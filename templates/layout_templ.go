// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.943
package templates

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import (
	"github.com/invopop/ctxi18n/i18n"
	"seanAIgent/components/calendar"
	"seanAIgent/components/datepicker"
	"seanAIgent/components/popover"
	"seanAIgent/components/tabs"
	"seanAIgent/components/timepicker"
	"seanAIgent/components/toast"
)

type OgMeta struct {
	Title       string
	Description string
	Image       string
}

func Layout(content templ.Component, liffId string, ogMeta *OgMeta) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<!doctype html><html class=\"dark\"><head><meta charset=\"UTF-8\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"><!-- 基本 Open Graph 資訊 --><meta property=\"og:title\" content=\"")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var2 string
		templ_7745c5c3_Var2, templ_7745c5c3_Err = templ.JoinStringErrs(ogMeta.Title)
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `templates/layout.templ`, Line: 26, Col: 56}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var2))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "\"><meta property=\"og:description\" content=\"")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var3 string
		templ_7745c5c3_Var3, templ_7745c5c3_Err = templ.JoinStringErrs(ogMeta.Description)
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `templates/layout.templ`, Line: 27, Col: 68}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var3))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 3, "\"><meta property=\"og:image\" content=\"")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var4 string
		templ_7745c5c3_Var4, templ_7745c5c3_Err = templ.JoinStringErrs(ogMeta.Image)
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `templates/layout.templ`, Line: 28, Col: 56}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var4))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 4, "\"><meta property=\"og:type\" content=\"website\"><title>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var5 string
		templ_7745c5c3_Var5, templ_7745c5c3_Err = templ.JoinStringErrs(i18n.T(ctx, "layout.title"))
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `templates/layout.templ`, Line: 31, Col: 44}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var5))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 5, "</title><script src=\"https://static.line-scdn.net/liff/edge/versions/2.22.3/sdk.js\"></script><script src=\"https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.min.js\"></script><link rel=\"stylesheet\" href=\"/assets/css/output.css\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = datepicker.Script().Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = calendar.Script().Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = popover.Script().Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = timepicker.Script().Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = toast.Script().Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = tabs.Script().Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 6, "</head><body class=\"min-h-screen flex flex-col bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-50\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		if i18n.GetLocale(ctx) != nil {
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 7, "<main class=\"flex-grow\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = content.Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 8, "</main>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		} else {
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 9, "<script>\n                window.addEventListener('DOMContentLoaded', async () => {\n                try {\n                    // Initialize LIFF\n                    await liff.init({ liffId: \"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Var6, templ_7745c5c3_Err := templruntime.ScriptContentInsideStringLiteral(liffId)
			if templ_7745c5c3_Err != nil {
				return templ.Error{Err: templ_7745c5c3_Err, FileName: `templates/layout.templ`, Line: 52, Col: 56}
			}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var6)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 10, "\" });\n\n                    // Get current URL parameters\n                    const urlParams = new URLSearchParams(window.location.search);\n                    const currentUserToken = urlParams.get('user_token');\n\n                    // Get user's LINE language\n                    const liffLang = liff.getLanguage(); // e.g., 'zh-TW', 'en', 'ja'\n\n                    // Get current path\n                    const originPath = window.location.pathname;\n                    const pathParts = originPath.split('/');\n                    const currentLang = pathParts[1];\n                    let liffUserToken = null;\n                    if (liff.isLoggedIn()) {\n                        liffUserToken = liff.getAccessToken();\n                    } else {\n                        // Not logged in, no need to add user_token, but still need to handle language\n                        liff.login({\n                            redirectUri: window.location.href\n                        });\n                        return;\n                    }\n\n                    // Redirect if language is incorrect, or if user_token is missing but we have it from LIFF\n                    if (currentLang !== liffLang || (!currentUserToken && liffUserToken)) {\n                        const newPath = `/${liffLang}${originPath.endsWith('/') && originPath.length > 1 ? originPath.slice(0, -1) : originPath}`;\n                        const newUrl = new URL(newPath, window.location.origin);\n\n                        // Copy existing query params, but exclude user_token as we'll use the new one\n                        urlParams.forEach((value, key) => {\n                            if (key !== 'user_token') {\n                                newUrl.searchParams.append(key, value);\n                            }\n                        });\n\n                        // Append the new user_token if available\n                        if (liffUserToken) {\n                            newUrl.searchParams.append('user_token', liffUserToken);\n                        }\n\n                        window.location.replace(newUrl.toString());\n                        return; // Stop script execution after redirect\n                    }\n                    \n                    // If language and user_token are correct, proceed with page initialization\n                    console.log(\"LIFF init successful. Language:\", liffLang, \"UserToken:\", liffUserToken || \"Not Logged In\");\n\n                } catch (err) {\n                    console.error(\"LIFF init failed:\", err);\n                    // Optionally display an error message to the user\n                }\n                });\n            </script>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 11, "<div id=\"toast-trigger\" hx-trigger=\"click\" hx-swap=\"beforeend\" hx-target=\"body\" style=\"display: none;\"></div><script>\n\t\t\t\t\tfunction showToast({ title, description, variant = 'default', duration = 5000 }) {\n\t\t\t\t\t\tconsole.log(\"showToast function received:\", { title, description, variant, duration });\n\t\t\t\t\t\tconst trigger = document.getElementById('toast-trigger');\n\t\t\t\t\t\tif (!trigger) {\n\t\t\t\t\t\t\tconsole.error('Global toast trigger element (#toast-trigger) not found!');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst params = new URLSearchParams({\n\t\t\t\t\t\t\ttitle: title || '',\n\t\t\t\t\t\t\tdescription: description || '',\n\t\t\t\t\t\t\tvariant: variant,\n\t\t\t\t\t\t\tduration: duration,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconst url = `/components/toast?${params.toString()}`;\n\t\t\t\t\t\tconsole.log(\"Requesting toast HTML from URL:\", url);\n\t\t\t\t\t\ttrigger.setAttribute('hx-get', url);\n\t\t\t\t\t\thtmx.process(trigger);\n\t\t\t\t\t\ttrigger.click();\n\t\t\t\t\t}\n\t\t\n\t\t\t\t\tdocument.body.addEventListener('showToast', function(evt) {\n\t\t\t\t\t\tconsole.log(\"showToast event received from HX-Trigger:\", evt.detail);\n\t\t\t\t\t\tif (evt.detail) {\n                            console.log(evt.detail.description)\n                            console.log(decodeBase64Utf8(evt.detail.description))\n\t\t\t\t\t\t\tshowToast({\n                                title: decodeBase64Utf8(evt.detail.title), \n                                description: decodeBase64Utf8(evt.detail.description), \n                                variant: evt.detail.variant,\n                            });\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n                    function decodeBase64Utf8(base64String) {\n                        try {\n                            // 1. 用 atob() 解碼成 \"二進位字串\"\n                            const binaryString = atob(base64String);\n\n                            // 2. 建立一個 Uint8Array (位元組陣列) 來存放真正的 bytes\n                            const bytes = new Uint8Array(binaryString.length);\n                            for (let i = 0; i < binaryString.length; i++) {\n                            bytes[i] = binaryString.charCodeAt(i);\n                            }\n\n                            // 3. 使用 TextDecoder 將 UTF-8 位元組解碼回正確的 JavaScript 字串\n                            const decoder = new TextDecoder('utf-8');\n                            return decoder.decode(bytes);\n\n                        } catch (e) {\n                            console.error(\"Base64 解碼或 UTF-8 解析失敗:\", e);\n                            // 處理錯誤，例如回傳 null 或原始字串\n                            return null; \n                        }\n                    }\n\t\t\t\t</script></body></html>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
