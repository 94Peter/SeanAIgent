# 規格文件：我的預約頁面

## 一、總覽

本頁面提供使用者檢視自己所有未來的預約記錄，並能根據規則取消預約或請假。

## 二、通用規格

### 使用者驗證 (Authentication)
本頁面需要透過 LINE LIFF 取得使用者身份，並在 LINE App 環境中開啟。

### 導覽機制 (Navigation)
*   在頁面頂部，提供一個分頁導覽列，包含「預約時段」和「我的預約」兩個連結。
*   系統會自動高亮使用者所在的當前頁面分頁，方便使用者在兩個主要頁面之間快速切換。

### 介面與體驗建議 (UI/UX)
*   **即時回饋**: 所有預約與取消操作都應透過 HTMX 非同步完成，提供無刷新的流暢體驗。
*   **載入狀態**: 在 LIFF 初始化、載入時段列表等過程中，應提供明確的視覺提示。
*   **錯誤處理**: 所有非同步操作的失敗（如後端錯誤）都應透過頁面右上角的 Toast 元件給予使用者清晰的回饋。

--- 

## 三、我的預約頁面 (`/my-bookings`)

### 3.1 功能

讓使用者檢視自己所有未來的預約記錄，並能根據規則取消預約或請假。

### 3.2 主要畫面與元件

| 元件/欄位 | 類型 | 說明 |
| :--- | :--- | :--- |
| 導覽分頁 | Navigation | 「預約時段」與「我的預約」的切換連結。 |
| 日期標頭 | Header | 例如「10月26日 (週日)」。 |
| 預約項目卡片 | Card | 顯示單一孩子的預約資訊。 |
| **孩子姓名** | Text | 顯示已預約的孩子姓名。 |
| **時段與地點** | Text | 顯示該預約的詳細時間與地點。 |
| **取消/請假按鈕** | Button | 根據預約時間顯示不同按鈕。 |
| 分享按鈕 | Button | 讓使用者可以分享預約總覽狀況。 |

### 3.3 操作流程 (User Flow)

1.  **取消預約**:
    *   對於**24小時內**建立的預約，項目右側會顯示 `[ 取消預約 ]` 按鈕。
    *   點擊後，跳出確認對話框。
    *   確認後，該預約項目會從列表中移除，並彈出「取消成功」的 Toast 提示。
2.  **請假**:
    *   對於**超過24小時**建立的預約，按鈕會變為禁用的 `[ 我要請假 ]`。
    *   滑鼠懸浮在按鈕上時，會提示「預約已超過24小時，如需請假請直接聯繫教練」。
3.  **分享預約狀況**:
    *   點擊頁面底部的 `[ 分享預約狀況 ]` 按鈕。
    *   後端組合好完整的預約總覽文字訊息。
    *   前端呼叫 `liff.sendMessages()` 將訊息發送到當前聊天室。

--- 

## 四、後端 API 規格 (Backend API Specification)

### 1. 取得個人預約列表
*   **Endpoint**: (由渲染 `MyBookingsPage` 的 Go handler `getMyBookingsPage` 處理)
*   **描述**: 取得當前使用者所有未來的預約記錄，並渲染「我的預約」頁面。

### 2. 取消預約
*   **方法**: `POST`
*   **路徑**: `/booking/delete`
*   **參數**:
    *   `bookingId` (string): 欲取消的預約 ID。
*   **成功回傳**:
    *   **Code**: `200 OK`
    *   **Body**: (空)
    *   **Header**: `HX-Trigger-After-Settle` 包含成功 Toast 的 JSON payload (URL 編碼)。
*   **失敗回傳**:
    *   **Code**: `403 Forbidden`, `404 Not Found`。
    *   **Header**: `HX-Trigger-After-Settle` 包含錯誤 Toast 的 JSON payload (URL 編碼)。
