# 📅 專業運動預約系統行事曆 UI 規格書 (UI Spec) v2.0

本文件定義了新版預約系統的 UI/UX 規範。核心變更包含：**垂直無限滑動導航**、**以狀態為核心的色彩系統**（不再以顏色區分孩子）、以及針對 **3-5 位多孩子**場景的介面優化。

---

## 1. 視覺基礎與規範 (Visual Identity)

### 1.1 色彩計畫 (Color Palette)
系統採用 **深色模式 (Dark Mode)**。色彩語意由「區分人」改為「區分狀態」。

*   **基礎背景**: `#000000` (全黑) / `#1C1C1E` (元件背景).
*   **狀態色 (Status Colors)**:
    *   🔵 **已預約 (Booked)**: `#60A5FA` (Blue-400) - 代表確認、正常上課。
    *   🔴 **請假 (Leave)**: `#F87171` (Red-400) - 代表缺席、警示。
    *   ⚫ **未預約 (Available)**: `#27272A` (Zinc-800) 背景 + 灰色文字 - 代表可操作但未選中。
    *   🟢 **已簽到 (Checked-in)**: `#34D399` (Emerald-400) - 代表出席確認。
    *   ⚪ **過去 (Past)**: `Opacity 40%` - 視覺後退，不強調。
*   **功能按鈕**:
    *   🟡 **主要行動 (Primary)**: `#FFD700` (Gold) - 用於「新增預約」等強調操作。
    *   🟢 **分享 (Share)**: `#06C755` (LINE Green) - 用於 LINE 相關功能。

### 1.2 字體 (Typography)
*   **英數**: SF Pro Display (iOS) 或 Inter (Web)，風格現代簡潔。
*   **中文**: PingFang TC (黑體)。
*   **層級**:
    *   **Month Title**: 28pt, Bold, White (e.g., "February").
    *   **Date/Day**: 16pt, Medium, White.
    *   **Course Name**: 14pt, Medium, White.
    *   **Meta Info**: 12pt, Regular, Gray-400 (地點、名額).

### 1.3 圖示 (Iconography)
*   使用 **Lucide Icons** 或 **Heroicons** (Rounded style)。
*   元件圓角統一為 **8px - 10px**。

---

## 2. 核心導航與交互 (Navigation & Interaction)

### 2.1 無限垂直滾動 (Continuous Vertical Scroll)
*   **操作**: 使用者 **上下滑動** 來查看過去與未來的週次。捨棄左右翻頁，建立連續的時間流體驗。
*   **吸附 (Snapping)**: 當滑動手勢停止時，視圖應自動吸附（Snap），確保「當前週」完整顯示在螢幕可視區域的上半部。
*   **標題連動**: 左上角的月份標題（如 "February"）需隨滑動到的日期動態更新。若跨月（如 2/28 - 3/1），標題應平滑過渡。

### 2.2 導航控制
*   **回到今天 (Today)**: 點擊頂部導航列的「Today」按鈕，視圖以平滑動畫 (Smooth Scroll) 滾動至本週，並短暫高亮今日日期格。
*   **視窗化渲染 (Windowing)**: 僅渲染螢幕可見範圍上下各 2-3 週的 DOM 節點，以確保無限滑動的效能流暢。

---

## 3. 佈局與元件規格 (Layout & Components)

### A. 頂部固定區 (Sticky Header)
此區域固定在頁面最上方，不隨行事曆滾動。
1.  **90天統計摘要 (Sticky Summary Bar)**:
    *   **區塊標題**: **最近 90 天訓練統計** (Title: Recent 90-Day Stats).
    *   **背景**: 深色背景 (`#121212`) 配淺灰文字 (`#8E8E93`)。
    *   **數據指標定義 (過去 90 天累計)**:
        *   **上 (Completed)**: 已簽到並完成的課程總數。
        *   **請 (Leave)**: 合乎規範的請假總數。
        *   **缺 (Absent)**: 未請假且未簽到的異常次數。
        *   **週 (Avg/Week)**: 平均每週上課堂數 (總上課數 ÷ 12.8週)。
    *   **UI 佈局 (Expandable Table)**:
        *   **左側 (全家總覽)**: 顯示全家累計總量。
            *   格式: `總計 48 堂 | 總請假 5`
            *   樣式: 數字使用 **亮白色** 強調。
        *   **右側 (個別明細 - 可展開表格)**:
            *   **預設狀態 (Collapsed)**: 僅顯示「標題列」或「第一位孩子」的數據摘要，右側附帶 **展開按鈕 (Chevron Down)**。
            *   **展開狀態 (Expanded)**: 向下展開完整數據表格，覆蓋部分行事曆區域 (Overlay)。
            *   **表格欄位**:
                *   `姓名` (Name)
                *   `上課` (Completed)
                *   `請假` (Leave)
                *   `缺席` (Absent) - **若 > 0 顯示紅色**
                *   `週均` (Avg)
            *   **視覺優化**:
                *   欄位對齊：數字靠右對齊，標題置中。
                *   行距：緊湊行高 (Compact Row Height) 以節省空間。
                *   背景：展開時表格背景需為不透明深灰 (`#1C1C1E`)，並帶有陰影。
    *   **空狀態處理 (Empty State Handling)**:
        *   若所有數據皆為 0，週上課數應顯示 **0.0**。
        *   若「總上課數」為 0，可在統計區下方提供微小引導文字：「尚未有 90 天紀錄，快去預約第一堂課吧！」
2.  **星期標列 (Weekday Row)**:
    *   顯示 `S M T W T F S`，提供日期對照。

### B. 主區：行事曆列表 (Calendar Grid)
*   **結構**: 垂直排列的週視圖，每行 7 天。
*   **日期格 (Date Cell)**:
    *   若該日無課且非今日，可保持留白或極簡顯示。
    *   **溢出處理**: 若單日課程 > 3 堂，該日期格支援「局部垂直捲動」或顯示 `+N`。
*   **課程膠囊 (Course Capsule) - 多子優化版**:
    *   **樣式**: 彈性高度的長條圓角矩形。
    *   **主標題**: 時間 + 課程名稱 (e.g., "16:30 足球").
    *   **孩子名單堆疊 (Name Tag Stack)**: 僅顯示「已處理」的孩子姓名縮寫。
        *   **顯示邏輯**: 僅顯示狀態為 **已預約** 或 **已請假** 的孩子。
        *   **樣式**: 極小化標籤 (Mini Tags)，垂直往下堆疊。
        *   **標籤顏色語意**:
            *   🔵 **藍底**: 已預約。
            *   🔴 **紅字/邊框**: 已請假。
            *   *(未預約之孩子不在此顯示)*
*   **空堂膠囊**: 深灰底 + 虛線邊框，顯示 "[可預約]"。

### C. 底部浮動區 (Fixed FABs)
*   **左下**: `[我的預約]` 按鈕 - 開啟詳細列表。
*   **右下**: `[LINE 分享]` 按鈕 - 觸發 LIFF 分享 Flex Message。

---

## 4. 互動視窗 (Popup Spec) - 多孩子優化

當使用者點擊任一「課程膠囊」或「空堂」時觸發。

### 4.1 資訊區
*   顯示完整資訊：`日期 (2/13)` | `時間 (16:30 - 18:00)` | `地點 (北安球場)` | `剩餘名額 (8/20)`.

### 4.2 智慧預約輸入 (Smart Booking Input)
針對 3-5 位孩子設計，捨棄傳統「預先列出所有孩子」的模式，改為 **輸入框 + 標籤系統**。

*   **混合輸入元件 (Hybrid Combobox)**:
    *   **常預約選單 (Dropdown)**: 點擊輸入框時，自動下拉顯示「常預約的孩子」清單，供快速點選。
    *   **自由輸入 (Free Text)**: 支援直接輸入新名字。
    *   **自動標籤化 (Auto-tagging)**:
        *   當輸入 `,` (逗號) 或按 `Enter` 時，自動將文字轉換為 **藍色標籤 (Booked Tag)**。
        *   點選下拉選單中的名字，亦自動加入標籤。
*   **標籤互動 (Tag Interaction)**:
    *   **預設狀態**: 新增的標籤預設為 🔵 **藍底 (已預約)**。
    *   **點擊行為 (On Click)**:
        *   **若標籤為「已預約」**:
            *   **T > 24h**: 跳出確認窗 **「是否取消預約？」**。
            *   **T < 24h**: 跳出確認窗 **「已超過取消時限，是否轉為請假？」**。
        *   **若標籤為「請假」**:
            *   跳出確認窗 **「是否取消請假（恢復預約）？」**。
*   **操作指引 (Helper Text)**:
    *   輸入框下方需顯示微小說明文字：「點擊標籤可管理狀態 (取消/請假)」。
*   **名額限制**: 輸入框需即時顯示「剩餘名額」，若名額為 0，輸入框變為 Disabled 或顯示警告。

**範例示意**:
```text
[ 2/13 16:30 北安 Junior ]

參與者:
[ 🔵 小明 (x) ] [ 🔵 小華 (x) ] [ 🔴 小東 (x) ] | <--- 輸入框游標在此閃爍

[ 快速選擇: 小強, 小美 ... ]  <--- 下拉選單

(i) 點擊標籤可管理狀態 (取消/請假)
```

---

## 5. 我的預約列表 (My Bookings Spec)

### 5.1 呈現方式
*   **Bottom Sheet** (底部抽屜) 或 **Full-screen Modal**。
*   具備「即將到來」與「歷史紀錄」分頁。

### 5.2 列表卡片設計
*   **標題**: 日期 + 時間 + 地點。
*   **參與名單 (Attendees)**: 採用與 **4.2 智慧預約輸入** 相同的名字標籤系統。
    *   **樣式**: 顯示孩子姓名標籤（縮寫）。
    *   **狀態色**: 🔵 藍底 (已預約) / 🔴 紅字 (已請假)。
    *   **標籤互動**: 點擊標籤觸發與 4.2 節相同的管理邏輯（依 T > 24h 判斷取消或請假，或恢復預約）。
*   **操作**:
    *   點擊卡片（非標籤區域）跳轉回行事曆對應日期的 Popup。
    *   管理功能統一透過點擊名字標籤觸發確認窗，卡片右側不再重複設置按鈕。

---

## 6. 錯誤處理 (RepoErr Standard)

UI 需根據 Backend 回傳的錯誤碼給予對應反饋：

| Error Code | 意義 | UI 行為 |
| :--- | :--- | :--- |
| `ERR_SLOT_FULL` | 名額已滿 | 點擊「未預約」標籤時，標籤閃爍紅框並 Toast 提示「名額已滿」。 |
| `ERR_SINGLE_CHILD_FAIL` | 單一失敗 | 特定孩子的標籤操作失敗，自動回復原狀態，不影響其他人。 |
| `ERR_BATCH_SYNC_FAIL` | 同步失敗 | 顯示「部分更新失敗，請刷新」，建議重新載入資料。 |
| `ERR_CANCEL_WINDOW_CLOSED` | 超過取消時限 | 提示「已超過取消期限，改為請假流程？」。 |
| `INF_END_OF_HISTORY` | 無更多資料 | 滑動至 90 天邊界時，底部顯示提示訊息。 |
