# 規格文件：新增訓練時段

## 一、畫面名稱

新增訓練時段

## 二、主要功能

提供具備管理員權限的使用者，透過 LINE LIFF 頁面，以非同步方式新增或刪除訓練時段。

## 三、權限控制 (Authorization)

本頁面具備嚴格的權限檢查機制，確保僅有授權的管理員可以操作。

1.  **頁面初始化**:
    *   進入頁面後，首先初始化 LINE LIFF SDK，畫面顯示「初始化 LIFF 中...」。

2.  **使用者登入檢查**:
    *   檢查使用者是否已登入 LINE。
    *   **未登入**: 提示「請在 LINE 中開啟以完成登入」，所有功能禁用。

3.  **管理員權限驗證**:
    *   **登入成功**: 取得使用者 `userId`。
    *   **API 呼叫**: 前端呼叫後端 API (`/follow/is-admin?userId=<USER_ID>`) 進行權限驗證。
    *   **驗證結果**:
        *   **是管理員**: 啟用所有表單與按鈕，提示訊息改為「請選擇日期與時間，並將其新增至下方清單。」
        *   **非管理員**: 顯示「您沒有權限操作此頁面」，所有功能禁用。

## 四、主要欄位與元件

| 元件/欄位 | 類型 | 說明 |
| :--- | :--- | :--- |
| **日期** | Date Picker | 選擇訓練日期。 |
| **開始時間** | Time Picker | 選擇時段的開始時間。 |
| **結束時間** | Time Picker | 選擇時段的結束時間。 |
| **新增按鈕** | Button | **非同步操作**。使用 HTMX 將目前輸入的時段加入下方清單。 |
| **已新增清單** | List | 動態顯示所有已加入的時段。 |
| **刪除按鈕** | Button | **非同步操作**。位於每筆時段旁，點擊可即時刪除該筆資料。 |

> **備註**:
> * 所有欄位與按鈕在權限驗證成功前，皆為 **禁用 (disabled)** 狀態。
> * 此頁面沒有「儲存全部」按鈕，所有操作（新增/刪除）均為即時、單筆的非同步請求。

## 五、操作流程 (User Flow)

1.  **進入頁面**:
    *   使用者開啟頁面，系統自動執行 **權限控制** 流程。
    *   只有授權的管理員能進入操作狀態。

2.  **新增時段**:
    *   使用者填寫「日期」、「開始時間」與「結束時間」。
    *   點擊「＋ 新增」按鈕。
    *   前端透過 HTMX 將資料 POST 至 `/training-date/add`。
    *   後端回傳更新後的時段列表，前端清單區域 (`#training-date-list`) 局部刷新，顯示新加入的時段。

3.  **刪除時段**:
    *   使用者點擊某個已新增時段旁的「刪除」按鈕。
    *   前端透過 HTMX 將該時段 ID POST 至 `/training-date/delete`。
    *   後端處理後，前端透過 `hx-swap="outerHTML"` 將該時段的整列元素從畫面移除。

## 六、介面與體驗建議 (UI/UX)

*   **動態刷新**: 所有操作均不刷新整個頁面，提供流暢的單頁應用體驗。
*   **錯誤提示**: 對於無效輸入（如結束時間早於開始時間），應即時顯示錯誤訊息。
*   **狀態顯示**: 在 LIFF 初始化、權限驗證等非同步過程中，應提供明確的文字提示，告知使用者目前系統狀態。

## 七、範例畫面結構 (Layout)

```
[日期選擇器] [開始時間選擇器] [結束時間選擇器]  [＋ 新增]

-----------------------------------------------------------
<!-- 此區塊由 HTMX 動態更新 -->
10/09 (週四) 07:00–08:00       [刪除按鈕]
10/10 (週五) 18:30–20:00       [刪除按鈕]
-----------------------------------------------------------
```