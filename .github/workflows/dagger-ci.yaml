name: Dagger CI             # 第一行必須是 Key，不能是 "-" 開頭的清單

on:
  push:
    branches: [ main ]      # 或是你的主分支名稱

jobs:
  dagger:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Run Dagger Call
        uses: dagger/dagger-for-github@v8.2.0
        with:
          verb: call
          # 注意這裡的縮進，args 應該在 with 底下
          args: >
            build-with-dockerfile 
            --src=. 
            --username=${{ secrets.DOCKERHUB_USER }} 
            --repo-name="seanaigent" 
            --tag=${{ github.sha }} 
            --docker-hub-token=env:DOCKERHUB_TOKEN
        env:
          # 這裡必須確保名稱與上面 args 裡的 env: 標記完全一致
          DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}
          # 雖然 username 不是 secret，但有時帶入環境變數傳遞會更穩定
          DOCKERHUB_USER: ${{ secrets.DOCKERHUB_USER }}