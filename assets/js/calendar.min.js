(function(){"use strict";function parseISODate(isoStr){if(!isoStr)return null;const parts=isoStr.split("-");if(parts.length!==3)return null;const year=parseInt(parts[0],10);const month=parseInt(parts[1],10)-1;const day=parseInt(parts[2],10);const date=new Date(Date.UTC(year,month,day));if(date.getUTCFullYear()===year&&date.getUTCMonth()===month&&date.getUTCDate()===day){return date}return null}function parseISODateArray(isoStr){if(!isoStr)return[];return isoStr.split(",").map(s=>parseISODate(s)).filter(d=>d!==null)}function getMonthNames(locale){try{return Array.from({length:12},(_,i)=>new Intl.DateTimeFormat(locale,{month:"short",timeZone:"UTC"}).format(new Date(Date.UTC(2e3,i,1))))}catch{return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}}function getDayNames(locale,startOfWeek){try{return Array.from({length:7},(_,i)=>new Intl.DateTimeFormat(locale,{weekday:"short",timeZone:"UTC"}).format(new Date(Date.UTC(2e3,0,i+2+startOfWeek))))}catch{return["Su","Mo","Tu","We","Th","Fr","Sa"]}}function findHiddenInput(container){const wrapper=container.closest("[data-tui-calendar-wrapper]");let hiddenInput=wrapper?.querySelector("[data-tui-calendar-hidden-input]");if(!hiddenInput&&container.id){const parentId=container.id.replace("-calendar-instance","");hiddenInput=document.getElementById(parentId+"-hidden")}return hiddenInput}function renderCalendar(container){const weekdaysContainer=container.querySelector("[data-tui-calendar-weekdays]");const daysContainer=container.querySelector("[data-tui-calendar-days]");if(!weekdaysContainer||!daysContainer)return;let currentMonth=parseInt(container.dataset.tuiCalendarCurrentMonth);let currentYear=parseInt(container.dataset.tuiCalendarCurrentYear);if(isNaN(currentMonth)||isNaN(currentYear)){const initialMonth=parseInt(container.getAttribute("data-tui-calendar-initial-month"));const initialYear=parseInt(container.getAttribute("data-tui-calendar-initial-year"));const selectedDateAttr=container.getAttribute("data-tui-calendar-selected-date");if(selectedDateAttr){const firstSelected=parseISODateArray(selectedDateAttr)[0];if(firstSelected){currentMonth=firstSelected.getUTCMonth();currentYear=firstSelected.getUTCFullYear()}}if(isNaN(currentMonth)){currentMonth=!isNaN(initialMonth)?initialMonth:(new Date).getMonth()}if(isNaN(currentYear)){currentYear=!isNaN(initialYear)&&initialYear>0?initialYear:(new Date).getFullYear()}container.dataset.tuiCalendarCurrentMonth=currentMonth;container.dataset.tuiCalendarCurrentYear=currentYear}const locale=container.getAttribute("data-tui-calendar-locale-tag")||"en-US";const startOfWeek=parseInt(container.getAttribute("data-tui-calendar-start-of-week"))||1;const selectedDateStr=container.getAttribute("data-tui-calendar-selected-date");const selectedDates=selectedDateStr?parseISODateArray(selectedDateStr):[];const monthNames=getMonthNames(locale);const monthValue=container.querySelector(`#${container.id}-month-value`);const yearValue=container.querySelector(`#${container.id}-year-value`);if(monthValue)monthValue.textContent=monthNames[currentMonth];if(yearValue)yearValue.textContent=currentYear;if(!weekdaysContainer.children.length){const dayNames=getDayNames(locale,startOfWeek);weekdaysContainer.innerHTML=dayNames.map(day=>`<div class="text-center text-xs text-muted-foreground font-medium">${day}</div>`).join("")}daysContainer.innerHTML="";const firstDay=new Date(Date.UTC(currentYear,currentMonth,1));const startOffset=((firstDay.getUTCDay()-startOfWeek)%7+7)%7;const daysInMonth=new Date(Date.UTC(currentYear,currentMonth+1,0)).getUTCDate();const today=new Date;const todayUTC=new Date(Date.UTC(today.getFullYear(),today.getMonth(),today.getDate()));for(let i=0;i<startOffset;i++){daysContainer.innerHTML+='<div class="h-8 w-8"></div>'}for(let day=1;day<=daysInMonth;day++){const currentDate=new Date(Date.UTC(currentYear,currentMonth,day));const isSelected=selectedDates.some(d=>d.getTime()===currentDate.getTime());const isToday=currentDate.getTime()===todayUTC.getTime();let classes="inline-flex h-8 w-8 items-center justify-center rounded-md text-sm font-medium focus:outline-none focus:ring-1 focus:ring-ring";if(isSelected){classes+=" bg-primary text-primary-foreground hover:bg-primary/90"}else if(isToday){classes+=" bg-accent text-accent-foreground"}else{classes+=" hover:bg-accent hover:text-accent-foreground"}daysContainer.innerHTML+=`<button type="button" class="${classes}" data-tui-calendar-day="${day}">${day}</button>`}}document.addEventListener("change",e=>{if(e.target.matches("[data-tui-calendar-month-select]")){const container=e.target.closest("[data-tui-calendar-container]");if(!container)return;const newMonth=parseInt(e.target.value,10);if(isNaN(newMonth))return;container.dataset.tuiCalendarCurrentMonth=newMonth;renderCalendar(container);return}if(e.target.matches("[data-tui-calendar-year-select]")){const container=e.target.closest("[data-tui-calendar-container]");if(!container)return;const newYear=parseInt(e.target.value,10);if(isNaN(newYear))return;container.dataset.tuiCalendarCurrentYear=newYear;renderCalendar(container);return}});document.addEventListener("click",e=>{const prevBtn=e.target.closest("[data-tui-calendar-prev]");if(prevBtn){const container=prevBtn.closest("[data-tui-calendar-container]");if(!container)return;let month=parseInt(container.dataset.tuiCalendarCurrentMonth,10);let year=parseInt(container.dataset.tuiCalendarCurrentYear,10);if(isNaN(month))month=(new Date).getMonth();if(isNaN(year))year=(new Date).getFullYear();month--;if(month<0){month=11;year--}container.dataset.tuiCalendarCurrentMonth=month;container.dataset.tuiCalendarCurrentYear=year;renderCalendar(container);updateNativeSelects(container);return}const nextBtn=e.target.closest("[data-tui-calendar-next]");if(nextBtn){const container=nextBtn.closest("[data-tui-calendar-container]");if(!container)return;let month=parseInt(container.dataset.tuiCalendarCurrentMonth,10);let year=parseInt(container.dataset.tuiCalendarCurrentYear,10);if(isNaN(month))month=(new Date).getMonth();if(isNaN(year))year=(new Date).getFullYear();month++;if(month>11){month=0;year++}container.dataset.tuiCalendarCurrentMonth=month;container.dataset.tuiCalendarCurrentYear=year;renderCalendar(container);updateNativeSelects(container);return}if(e.target.matches("[data-tui-calendar-day]")){e.stopPropagation();const container=e.target.closest("[data-tui-calendar-container]");if(!container)return;const multiple=container.getAttribute("data-tui-calendar-multiple")==="true";const day=parseInt(e.target.dataset.tuiCalendarDay);let month=parseInt(container.dataset.tuiCalendarCurrentMonth,10);let year=parseInt(container.dataset.tuiCalendarCurrentYear,10);if(isNaN(month))month=(new Date).getMonth();if(isNaN(year))year=(new Date).getFullYear();const clickedDate=new Date(Date.UTC(year,month,day));const clickedDateISO=clickedDate.toISOString().split("T")[0];let newSelectedISO="";if(multiple){const selectedDateStr=container.getAttribute("data-tui-calendar-selected-date")||"";let selectedDates=selectedDateStr.split(",").filter(d=>d);const dateIndex=selectedDates.indexOf(clickedDateISO);if(dateIndex>-1){selectedDates.splice(dateIndex,1)}else{selectedDates.push(clickedDateISO)}newSelectedISO=selectedDates.join(",")}else{newSelectedISO=clickedDateISO}container.setAttribute("data-tui-calendar-selected-date",newSelectedISO);const hiddenInput=findHiddenInput(container);if(hiddenInput){hiddenInput.value=newSelectedISO;hiddenInput.dispatchEvent(new Event("change",{bubbles:true}))}const detail={date:clickedDate,dates:newSelectedISO.split(",").filter(d=>d).map(s=>parseISODate(s))};console.log("calendar-date-selected dispatched:",detail);container.dispatchEvent(new CustomEvent("calendar-date-selected",{bubbles:true,detail:detail}));setTimeout(()=>{renderCalendar(container)},0)}});function updateNativeSelects(container){const month=parseInt(container.dataset.tuiCalendarCurrentMonth,10);const year=parseInt(container.dataset.tuiCalendarCurrentYear,10);if(isNaN(month)||isNaN(year))return;const monthSelect=container.querySelector("[data-tui-calendar-month-select]");if(monthSelect){monthSelect.value=month.toString()}const yearSelect=container.querySelector("[data-tui-calendar-year-select]");if(yearSelect){yearSelect.value=year.toString()}}document.addEventListener("reset",e=>{if(!e.target.matches("form"))return;e.target.querySelectorAll("[data-tui-calendar-container]").forEach(container=>{const hiddenInput=findHiddenInput(container);if(hiddenInput){hiddenInput.value=""}container.removeAttribute("data-tui-calendar-selected-date");const today=new Date;container.dataset.tuiCalendarCurrentMonth=today.getMonth();container.dataset.tuiCalendarCurrentYear=today.getFullYear();renderCalendar(container)})});const observer=new MutationObserver(()=>{document.querySelectorAll("[data-tui-calendar-container]").forEach(container=>{const daysContainer=container.querySelector("[data-tui-calendar-days]");if(daysContainer&&!daysContainer.children.length){renderCalendar(container)}})});observer.observe(document.body,{childList:true,subtree:true});function initCalendars(){document.querySelectorAll("[data-tui-calendar-container]").forEach(container=>{const locale=container.getAttribute("data-tui-calendar-locale-tag")||"en-US";const monthNames=getMonthNames(locale);const monthSelect=container.querySelector("[data-tui-calendar-month-select]");if(monthSelect){const options=monthSelect.querySelectorAll("option");options.forEach((option,index)=>{if(monthNames[index]){option.textContent=monthNames[index]}})}renderCalendar(container)})}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",initCalendars)}else{initCalendars()}})();